import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css             *//* empty css                        */import"./api.client-Cwoejsn1.js";import{M as E}from"./main-FYAW3UC_.js";const $=document.getElementById("title"),x=document.getElementById("genres"),S=document.getElementById("searchBtn"),B=document.getElementById("grid"),m=document.getElementById("status"),T=document.getElementById("prev"),N=document.getElementById("next"),k=document.getElementById("pageDisplay"),I=document.getElementById("limitInput");let p=1,L=parseInt(I.value,10)||20,w=1,H={title:"",genres:[]};function C(t){if(!t)return null;if(typeof t=="string")return t;const e=Object.keys(t);for(const a of["en","en-us","en-gb"])if(t[a])return t[a];return t[e[0]]}function v(t){return String(t||"").replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e])}function q(t,e=260){return t?t.length>e?t.slice(0,e).trim()+"...":t:""}async function _(){x.innerHTML="",m.textContent="Завантаження жанрів...";try{const e=(await E._ensureTagCache())?.tags||[],a={};for(const n of e){const s=(n.attributes?.group||"other").toString();a[s]=a[s]||[],a[s].push(n)}const r=n=>n?n[0].toUpperCase()+n.slice(1):"Інші";for(const n of Object.keys(a)){const s=document.createElement("fieldset");s.className="genres-group";const i=document.createElement("legend");i.className="genres-group__title",i.textContent=r(n),s.appendChild(i);const d=document.createElement("div");d.className="genres-group__list";for(const o of a[n]){const h=o.attributes?.name?.en||Object.values(o.attributes?.name||{})[0]||o.id,f=o.id,g=document.createElement("label");g.className="genres-chip";const u=document.createElement("input");u.type="checkbox",u.value=f,u.id=`tag-${f}`,u.dataset.group=n;const l=document.createElement("span");l.className="genres-chip__label",l.textContent=h,g.appendChild(u),g.appendChild(l),d.appendChild(g)}s.appendChild(d),x.appendChild(s)}m.textContent=`Жанрів завантажено: ${e.length}`;const c=document.getElementById("genreFilter");c.addEventListener("input",()=>{const n=c.value.trim().toLowerCase();x.querySelectorAll("label.genres-chip").forEach(i=>{const d=i.textContent.trim().toLowerCase();i.style.display=d.includes(n)?"":"none"})})}catch(t){m.textContent="Не вдалося завантажити жанри",console.warn("Failed to load genres via proxy:",t)}}async function A(t){B.innerHTML="";const e=[];for(const a of t){const r=a.id,c=a.attributes||{},n=C(c.title)||"(Без назви)",s=c.altTitles&&c.altTitles.length?C(c.altTitles[0]):"",i=C(c.description)||"",d=(c.tags||[]).map(l=>l?.attributes?.name&&C(l.attributes.name)||"").filter(Boolean),o=document.createElement("article");o.className="card";const h=document.createElement("img");h.className="thumb",h.alt=n,h.src="/css/placeholder.png";const f=document.createElement("div");f.className="meta",f.innerHTML=`
        <div class="title">${v(n)}</div>
        <div class="subtitle">${v(s)}</div>
        <div class="desc">${v(q(i,300))}</div>
      `;const g=document.createElement("div");g.className="tags";for(const l of d){const y=document.createElement("div");y.className="tag",y.textContent=l,g.appendChild(y)}f.appendChild(g),o.appendChild(h),o.appendChild(f),o.style.cursor="pointer",o.addEventListener("click",()=>{window.location.href=`/manga.html?id=${encodeURIComponent(r)}`}),B.appendChild(o);const u=(a.relationships||[]).find(l=>l.type==="cover_art");if(u&&u.id){const l=E.callProxy(`/cover/${u.id}`).then(y=>{const M=(y?.data||y)?.attributes?.fileName;M&&(h.src=`https://uploads.mangadex.org/covers/${r}/${M}`)}).catch(()=>{});e.push(l)}}await Promise.allSettled(e),D()}function O(){return Array.from(x.querySelectorAll("input[type=checkbox]:checked")).map(e=>e.value).filter(Boolean)}async function P(t){const e=document.getElementById("tagMap");e.innerHTML="Обробка жанрів...";try{const r=(await E._ensureTagCache())?.tags||[],c=new Map(r.map(s=>[s.id,s])),n=[];for(let s=0;s<t.length;s++){const i=t[s],d=c.get(i),o=d?d.attributes?.name?.en||Object.values(d.attributes?.name||{})[0]:"(невідомо)";n.push(`<div class="tagMap__row">${v(o)} → ${i?`<code class="tagMap__code">${i}</code>`:'<span class="tagMap__error">(not found)</span>'}</div>`)}e.innerHTML=n.join("")}catch(a){e.innerHTML="Помилка обробки жанрів: "+v(String(a))}}async function b(t=1){try{L=parseInt(I.value,10)||20;const e=$.value.trim(),a=O();P(a),H={title:e,genres:a},m.textContent="Пошук...";const r=await E.search({title:e,genres:a,page:t,limit:L}),c=r?.data||[],n=r?.total||c.length||0;w=Math.max(1,Math.ceil(n/L)),p=t,k.textContent=String(p),T.disabled=p<=1,N.disabled=p>=w,c.length?m.textContent=`Показано ${c.length} із ${n}`:m.textContent="Немає результатів",await A(c)}catch(e){m.textContent="Помилка пошуку: "+(e.message||e),B.innerHTML="<pre>"+v(String(e))+"</pre>"}}function D(){document.querySelectorAll(".tags").forEach(t=>{const e=Array.from(t.querySelectorAll(".tag")),a=4;if(e.length<=a)return;const r=e.slice(a);r.forEach(s=>{s.style.display="none"});const c=r.length,n=document.createElement("div");n.className="tag-more",n.textContent=`+${c}`,t.appendChild(n)})}S.addEventListener("click",()=>b(1));T.addEventListener("click",()=>{p>1&&b(p-1)});N.addEventListener("click",()=>{p<w&&b(p+1)});I.addEventListener("change",()=>b(1));document.getElementById("refreshTagsBtn").addEventListener("click",async()=>{m.textContent="Оновлення кешу жанрів...";try{await E.refreshTagCache(),m.textContent="Кеш жанрів оновлено",await _()}catch(t){m.textContent="Помилка оновлення кешу:: "+(t.message||t)}});await _();
