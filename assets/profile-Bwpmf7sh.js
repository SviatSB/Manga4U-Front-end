import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css             */import"./main-FYAW3UC_.js";(()=>{const A="https://manga4u-164617ec4bac.herokuapp.com",l={me:"/api/Account/me",changeNickname:"/api/Account/change-nickname",changePassword:"/api/Account/change-password",changeAvatar:"/api/Account/change-avatar",resetAvatar:"/api/Account/reset-avatar",setLanguage:"/api/Account/language",setAbout:"/api/Account/about"},r=(i,n=document)=>n.querySelector(i),E=()=>r("#formMessages");function t(i,n="ok"){const g=E();if(!g)return alert(i);const s=document.createElement("div");s.className=`msg ${n==="err"?"msg--err":"msg--ok"}`,s.textContent=i,g.appendChild(s),setTimeout(()=>s.remove(),4e3)}async function u(i,n={}){const g=localStorage.getItem("m4u_token")||sessionStorage.getItem("m4u_token");if(!g)throw new Error("No token found");const s=`${A}${i}`,m=new Headers(n.headers||{});m.set("Authorization",`Bearer ${g}`),n.body instanceof FormData||m.set("Content-Type","application/json");const d=await fetch(s,{...n,headers:m}),w=await d.text();let c;try{c=w?JSON.parse(w):null}catch{c=w}if(!d.ok){const p=new Error(c?.message||c||d.statusText);throw p.status=d.status,p}return c}async function O(){const i=r("#profileForm"),n=r("#nick"),g=r("#email"),s=r("#passOld"),m=r("#passNew"),d=r("#passNew2"),w=r("#avatarInput"),c=r("#avatarPreview"),p=r("#avatarRemove"),T=i?.querySelector('button[type="submit"]'),L=r("#lang"),b=r("#bio");let y="",P="",N="";try{const e=await u(l.me);if(g.value=e.login||e.email||"",y=e.nickname||e.userName||"",n.value=y,e.language&&(L.value=e.language.toLowerCase(),P=e.language.toLowerCase()),e.aboutMyself&&(b.value=e.aboutMyself,N=e.aboutMyself),e.avatarUrl){const a=e.avatarUrl.startsWith("http")?e.avatarUrl:`${A}/${e.avatarUrl.replace(/^\/+/,"")}`;c.src=a}}catch(e){console.error("Not authorized:",e),t("Потрібна авторизація","err"),setTimeout(()=>location.href="./auth.html?next=./profile.html",3e3);return}w?.addEventListener("change",async e=>{const a=e.target.files?.[0];if(!a)return;if(a.size>2*1024*1024){t("Файл занадто великий (>2МБ)","err");return}const o=new FormData;o.append("file",a);try{await u(l.changeAvatar,{method:"PATCH",body:o}),c.src=URL.createObjectURL(a),t("Аватар оновлено ✅")}catch(h){console.error("Avatar change failed:",h),t(h.message||"Помилка при зміні аватара","err")}}),p?.addEventListener("click",async()=>{try{await u(l.resetAvatar,{method:"PATCH"}),c.src=`${A}/avatar/default.png`,t("Аватар скинуто до стандартного ✅")}catch(e){console.error("Reset avatar failed:",e),t(e.message||"Помилка при скиданні аватара","err")}}),T?.addEventListener("click",async e=>{e.preventDefault();const a=n.value.trim(),o=L.value.trim().toLowerCase(),h=b.value.trim(),C=s.value.trim(),f=m.value.trim(),S=d.value.trim();let v=!1;if(a!==y)try{await u(l.changeNickname,{method:"PATCH",body:JSON.stringify(a)}),t("Нікнейм змінено ✅"),y=a,v=!0}catch(k){t(k.message||"Помилка при зміні ніку","err")}if(o&&o!==P)try{await u(l.setLanguage,{method:"PATCH",body:JSON.stringify(o)}),t("Мову інтерфейсу змінено ✅"),P=o,v=!0}catch{t("Помилка при зміні мови","err")}if(h!==N)try{await u(l.setAbout,{method:"PATCH",body:JSON.stringify(h)}),t("Інформацію “про себе” оновлено ✅"),N=h,v=!0}catch{t("Помилка при оновленні поля “про себе”","err")}if(C.length>0&&f.length>0&&S.length>0)try{if(f!==S)throw new Error("Паролі не співпадають");if(f.length<8)throw new Error("Мінімум 8 символів");await u(l.changePassword,{method:"POST",body:JSON.stringify({OldPassword:C,NewPassword:f})}),t("Пароль змінено ✅"),s.value=f,m.value=d.value="",v=!0}catch(k){t(k.message||"Помилка при зміні паролю","err")}v||t("Зміни відсутні","err")}),document.querySelectorAll(".form__togglePass").forEach(e=>{e.innerHTML=`
        <svg viewBox="0 0 24 24">
          <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
      `,e.addEventListener("click",()=>{const a=e.closest(".pw")?.querySelector("input");if(!a)return;const o=a.type==="password";a.type=o?"text":"password",e.classList.toggle("active",o)})})}document.addEventListener("DOMContentLoaded",O)})();
