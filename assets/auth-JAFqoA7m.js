import"./modulepreload-polyfill-B5Qt9EMX.js";const h="https://manga4u-164617ec4bac.herokuapp.com",i={key:"m4u_token",skey:"m4u_token_session",get(){return localStorage.getItem(this.key)||sessionStorage.getItem(this.skey)},set(t,e=!0){if(!t){console.error("‚ùå Token is empty, not saving");return}e?(localStorage.setItem(this.key,t),console.log("‚úÖ Token saved permanently (localStorage):",t.slice(0,25)+"...")):(sessionStorage.setItem(this.skey,t),console.log("‚úÖ Token saved for session:",t.slice(0,25)+"..."))},clear(){localStorage.removeItem(this.key),sessionStorage.removeItem(this.skey)}};async function l(t,e={}){const a=i.get(),s=new Headers(e.headers||{});e.body&&!(e.body instanceof FormData)&&s.set("Content-Type","application/json"),a&&s.set("Authorization",`Bearer ${a}`);const o=await fetch(`${h}${t}`,{method:e.method||"GET",headers:s,body:e.body&&!(e.body instanceof FormData)?JSON.stringify(e.body):e.body,credentials:"include"}),c=await o.text();let n=null;try{n=c?JSON.parse(c):null}catch{n=c}if(!o.ok){const r=n&&(n.message||n.title)||n||o.statusText;throw new Error(r)}return n}const g=document.getElementById("tab-login-btn"),d=document.getElementById("tab-register-btn"),u=document.getElementById("form-login"),y=document.getElementById("form-register");function m(t){const e=t==="login";g.classList.toggle("auth__tab--active",e),d.classList.toggle("auth__tab--active",!e),u.classList.toggle("form--visible",e),y.classList.toggle("form--visible",!e)}g.addEventListener("click",()=>m("login"));d.addEventListener("click",()=>m("register"));document.querySelectorAll("[data-switch]").forEach(t=>t.addEventListener("click",()=>m(t.dataset.switch)));document.querySelectorAll(".form__togglePass").forEach(t=>{t.addEventListener("click",()=>{const e=t.previousElementSibling;e.type=e.type==="password"?"text":"password"})});u.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("login-email").value.trim(),a=document.getElementById("login-password").value.trim(),s=document.getElementById("login-messages");try{const o=await l("/api/Account/login",{method:"POST",body:{login:e,password:a}});if(!o||!o.token)throw new Error("–°–µ—Ä–≤–µ—Ä –Ω–µ –ø–æ–≤–µ—Ä–Ω—É–≤ —Ç–æ–∫–µ–Ω!");i.set(o.token,!0),s.textContent="‚úÖ –í—Ö—ñ–¥ —É—Å–ø—ñ—à–Ω–∏–π!",console.log("‚úÖ Token –æ—Ç—Ä–∏–º–∞–Ω–æ:",o.token),console.log("üì¶ Token check:",i.get()),setTimeout(()=>location.href="./index.html",800)}catch(o){console.error("Login error:",o),s.textContent="‚ùå "+(o.message||"–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É")}});y.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("reg-nickname").value.trim(),a=document.getElementById("reg-login").value.trim(),s=document.getElementById("reg-password").value.trim(),o=document.getElementById("reg-password2").value.trim(),c=document.getElementById("reg-terms").checked,n=document.getElementById("register-messages");if(!c)return n.textContent="‚ùå –ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –∑–≥–æ–¥—É –∑ –ø—Ä–∞–≤–∏–ª–∞–º–∏";if(s!==o)return n.textContent="‚ùå –ü–∞—Ä–æ–ª—ñ –Ω–µ –∑–±—ñ–≥–∞—é—Ç—å—Å—è";try{await l("/api/Account/register",{method:"POST",body:{login:a,password:s,nickname:e}}),n.textContent="‚úÖ –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞!";const r=await l("/api/Account/login",{method:"POST",body:{login:a,password:s}});if(console.log("üì¶ Full response object:",r),!r||!r.token)throw new Error("–°–µ—Ä–≤–µ—Ä –Ω–µ –ø–æ–≤–µ—Ä–Ω—É–≤ —Ç–æ–∫–µ–Ω!");i.set(r.token,!0),console.log("‚úÖ Token –ø—ñ—Å–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó:",r.token),setTimeout(()=>location.href="./index.html",800)}catch(r){console.error("Register error:",r),n.textContent="‚ùå "+(r.message||"–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó")}});
